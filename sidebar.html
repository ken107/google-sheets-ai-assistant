<!DOCTYPE html>
<html>
  <head>
    <title>AI Assistant Chat</title>
    <meta charset="utf-8">
    <base target="_blank">

    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <?!= include("common.html") ?>

    <style>
      .sidebar.bottom {
        border-top: 1px solid #cecece;
        background-color: lightgray;
      }
      .chat-inputbox {
        display: flex;
      }
      .chat-inputbox input {
        flex: 1;
        height: auto;
      }
      .chat-inputbox button {
        flex: 0;
      }
    </style>

    <script src="https://assets.lsdsoftware.com/lib/databind.js"></script>

    <script>
      agentConfig = null
      loadSettings()

      async function loadSettings() {
        agentConfig = await gsRun(r => r.getAgentConfig())
      }

      async function editSettings() {
        await gsRun(r => r.showSettingsDialog())
        addEventListener("focus", () => loadSettings(), {once: true})
      }

      async function submitChat(form) {
        console.log(form.message.value)
        form.reset()
      }
    </script>
  </head>
  <body>
    <div bind-repeater-if="#progress ? 1 : 0">
      <div class="sidebar">
        <div class="spinner"></div>
      </div>
    </div>

    <div bind-repeater-if="!#progress ? 1 : 0">
      <div class="sidebar branding-below">
        <span bind-repeater-if="#agentConfig ? 1 : 0">You're chatting with {{#agentConfig.name}}.</span>
        <span bind-repeater-if="!#agentConfig ? 1 : 0">Click settings to configure your AI assistant.</span>
        <button type="button"
          bind-event-click="this.editSettings()">Settings</button>
      </div>

      <div class="sidebar bottom"
        bind-repeater-if="#agentConfig ? 1 : 0">
        <form bind-event-submit="this.submitChat(thisElem); return false">
          <div class="chat-inputbox">
            <input type="text" name="message">
            <button type="submit" class="action">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
